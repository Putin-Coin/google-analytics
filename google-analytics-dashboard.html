<link rel="import" href="google-analytics-base.html">

<!--
Element for grouping Google Analytics elements together.

`<google-analytics-chart>` elements inside a `<google-analytics-dashboard>`
element will automatically update as control elements (e.g.
`<google-analytics-view-selector>` or `<google-analytics-date-selector>`)
update query parameters.

##### Example

    <google-analytics-dashboard>

      <google-analytics-view-selector></google-analytics-view-selector>
      <google-analytics-date-selector></google-analytics-date-selector>

      <google-analytics-chart
        metrics="ga:sessions"
        dimensions="ga:country"
        sort="-ga:sessions"
        maxResults="5"
        chartType="column">
      </google-analytics-chart>

    </google-analytics-dashboard>

@element google-analytics-dashboard
@extends google-analytics-base
@blurb Element for grouping Google Analytics control and visualization elements.
@status alpha
@homepage http://polymerlabs.github.io/google-analytics
-->

<polymer-element
  name="google-analytics-dashboard"
  extends="google-analytics-base">

  <template>
    <content></content>
  </template>

  <script>

    Polymer('google-analytics-dashboard', {
      created: function() {
        this.super();
        this.addEventListener('analytics-dashboard-control-change', function(event) {

          // When components inside a google-analytics-dashboard element fire the
          // analytics-dashboard-control-change event, they will pass along the
          // query paramters that have changed.
          var charts = this.querySelectorAll('google-analytics-chart');
          for (var i = 0, chart; chart = charts[i]; i++) {
            Object.keys(event.detail).forEach(function(key) {
              chart[key] = event.detail[key];
            })
          }

          // This event is only relevant to google-analytics-dashboard elements
          // and their children, so no need to bubble up to the document
          event.stopPropagation();

        }.bind(this));
      },

      analyticsLoad: function() {
        this.super();
        this.setAttribute('loaded', '');
      },

      analyticsAuthorize: function() {
        this.super();
        this.setAttribute('authorized', '');
      }

    });

  </script>

</polymer-element>

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../google-apis/google-client-api.html">

<!--
The base element for other google analytics elements. This element is not
intended to be used by itself. It is only intended to be subclassed.

@element google-analytics-base
@blurb Base element for other google analytics elements
@status alpha
@homepage http://polymerlabs.github.io/google-analytics
-->

<polymer-element name="google-analytics-base">
  <template>
    <google-api-loader id="analytics"
      name="analytics"
      version="v3"
      on-google-api-load="{{analyticsLoad}}">
    </google-api-loader>
  </template>

  <script>

    (function() {

      var isLoaded = false;
      var isAuthorized = false;

      Polymer('google-analytics-base', {

        /**
         * The `loaded` attribute is true when the underlying analytics library
         * is fully loaded.
         *
         * @attribute loaded
         * @type boolean
         */
        get loaded() {
          return isLoaded;
        },

        /**
         * The `authorized` attribute is true once the user successfully signs in.
         *
         * @attribute authorized
         * @type boolean
         */
        get authorized() {
          return isAuthorized;
        },

        created: function() {
          document.addEventListener('google-signin-success', function(event) {
            isAuthorized = true;
            this.analyticsAuthorize(event.detail.result);
          }.bind(this));
        },

        /**
         * The `analyticsLoad` method will be invoked when the analytics library
         * and its dependencies are fully loaded.
         * At this point, all the methods on `gapi.analytics` are available.
         *
         * @method analyticsLoad
         */
        analyticsLoad: function() {
          this.loaded = true;
        },

        /**
         * The `analyticsAuthorize` method will be invoked when the user has
         * successfully signed in and this has been reported to the underlying
         * analytics library. `gapi.analytics.auth.isAuthorized()` will be true.
         *
         * @method analyticsAuthorize
         * @param {Object} data - The auth data information.
         */
        analyticsAuthorize: function(data) {
          this.authorized = true;
        }

      });

    }());

  </script>

</polymer-element>
